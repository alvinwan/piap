{% extends "group/group.html" %}
{% set panel='Events' %}
{% block panel %}
<div class="queue events">
<h1 class="col-md-6">Events</h1>
{% if current_user.can('create_event') %}
<div class="col-md-6">
  <a href="{{ the_url('group.sync', service='googlecalendar') }}" class="tr-action right button sm compact color">Google Calendar Sync</a>
  <a href="{{ the_url('group.import_signups') }}" class="tr-action right button sm compact color">Import Signups</a>
  <a href="{{ the_url('group.process') }}" class="tr-action right button sm compact color">Process Waitlists</a>
</div>
{% endif %}
<table>
<tr><th>Name</th><th>Start</th><th>End</th><th class="hidden-xs">Time Until Start</th><th class="hidden-xs">Signups</th>{% if current_user.is_authenticated %}<th>Actions</th>{% endif %}</tr>
{% set pagination=g.group.events(page=page, per_page=10) %}
{% for event in pagination.items %}
<tr>
  <td><a href="{{ the_url('event.home', event_id=event.id) }}">{{ event.to_local('start', 'end').name }}</a></td>
  <td>{{ event.start.format('h:mm a') }}</td>
  <td>{{ event.end.format('h:mm a') }}</td>
  <td class="hidden-xs">{{ event.start.humanize() }}</td>
  <td class="hidden-xs">{{ event.num_non_waitlisted_signups }}{% if event.setting('min_signups').is_active %}/{{ event.setting('min_signups').value }}{% endif %}</td>
  <td>
    {% if current_user.can('create_event') %}
    <a href="{{ the_url('event.delete', event_id=event.id) }}" class="button xs compact warning">Delete</a>
    <a href="{{ the_url('event.edit', event_id=event.id) }}" class="button xs compact color">Edit</a>
    <a href="{{ the_url('event.settings', event_id=event.id) }}" class="button xs compact color"><i class="fa fa-cog"></i></a>
    {% endif %}
    {% if current_user.is_authenticated %}
    {% if event.setting('enable_signups').is_active and current_user not in event and event.num_signups < event.setting('max_signups').value | int %}
    <a href="{{ the_url('event.signup', event_id=event.id) }}" class="button xs compact color">Signup</a>
    {% elif event.setting('enable_leave').is_active and current_user in event and event.num_signups > event.setting('min_signups').value | int %}
    <a href="{{ the_url('event.leave', event_id=event.id) }}" class="button xs compact color">Leave</a>
    {% endif %}
    {% endif %}
  </td>
</tr>
{% endfor %}
{% if g.group.num_events == 0 %}
<p class="queue-note">Looks like you've just created your group! Click to <a href="{{ the_url('group.create_event') }}">create an event</a>.</p>
{% endif %}
</table>
<div class=pagination>
  {% for page in pagination.iter_pages() %}
    {% if page %}
      {% if page != pagination.page %}
        <a class="page-item" href="{{ the_url('group.events', page=page) }}"><span>{{ page }}</span></a>
      {% else %}
        <div class="page-item"><span>{{ page }}</span></div>
      {% endif %}
    {% else %}
      <span class=ellipsis>...</span>
    {% endif %}
  {% endfor %}
  </div>
{% endblock %}
